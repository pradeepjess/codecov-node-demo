name: Node CI + Codecov
 
on:

  push:

    branches: [ "main" ]

  pull_request:

    types: [opened, synchronize, reopened]
 
jobs:

  test-and-codecov:

    runs-on: ubuntu-latest

    steps:

      - name: Checkout code

        uses: actions/checkout@v4

        with:

          fetch-depth: 0
 
      - name: Use Node.js

        uses: actions/setup-node@v4

        with:

          node-version: '18'
 
      - name: Install dependencies

        run: npm ci || npm install
 
      - name: Run tests with coverage

        run: npm test
 
      - name: Upload coverage to Codecov

        uses: codecov/codecov-action@v4

        with:

          files: coverage/lcov.info

          flags: unittests

          fail_ci_if_error: true
        env:
          CODECOV_TOKEN: ${{ secrets.CODECOV_TOKEN }}